////////////////////////////////////////////////////////////
// Описание пакета для сборки и установки
// Полную документацию см. на hub.oscript.io/packaging
//

///////////////////////////////////////////////////////////////////
// Процедуры установки пакета с клиентской машины        
///////////////////////////////////////////////////////////////////


// Вызывается пакетным менеджером перед установкой пакета на клиентскую машину.
// 
// Параметры:
//   КаталогУстановкиПакета - строка. Путь в который пакетный менеджер устанавливает текущий пакет.
//   ЧтениеZipФайла - ЧтениеZipФайла. Архив пакета.
// 
Процедура ПередУстановкой(Знач КаталогУстановкиПакета, Знач ЧтениеZipФайла) Экспорт
	// TODO: Реализуйте спец. логику перед установкой, если требуется
КонецПроцедуры


// Вызывается пакетным менеджером после распаковки пакета на клиентскую машину.
// 
// Параметры:
//   КаталогУстановкиПакета - строка. Путь в который пакетный менеджер устанавливает текущий пакет.
//   СтандартнаяОбработка - Булево. Возможность отменить стандартную обработку.
// 
Процедура ПриУстановке(Знач КаталогУстановкиПакета, СтандартнаяОбработка) Экспорт
	КопироватьФайл(КаталогУстановкиПакета + "/v8confbuilder.bat",КаталогУстановкиПакета + "/../../bin/v8confbuilder.bat")
КонецПроцедуры


///////////////////////////////////////////////////////////////////
// Процедуры сборки пакета                                          
///////////////////////////////////////////////////////////////////


// Вызывается пакетным менеджером перед началом сборки пакета.
// 
// Параметры:
//   РабочийКаталог - Строка - Текущий рабочий каталог с исходниками пакета.
// 
Процедура ПередСборкой(Знач РабочийКаталог) Экспорт
	// TODO: Реализуйте спец. логику сборки, если требуется
КонецПроцедуры


// Вызывается пакетным менеджером после помещения файлов в пакет.
// 
// Параметры:
//   РабочийКаталог - Строка - Текущий рабочий каталог с исходниками пакета.
//   АрхивПакета - ЗаписьZIPФайла - ZIP-архив с содержимым пакета (включаемые файлы).
// 
Процедура ПриСборке(Знач РабочийКаталог, Знач АрхивПакета) Экспорт
	// TODO: Реализуйте спец. логику сборки, если требуется
	АрхивПакета.Добавить(РабочийКаталог + "/v8confbuilder.bat", РежимСохраненияПутейZIP.СохранятьОтносительныеПути);
	АрхивПакета.Добавить(РабочийКаталог + "/v8confbuilder.os", РежимСохраненияПутейZIP.СохранятьОтносительныеПути);
	//	РежимОбработкиПодкаталоговZIP.ОбрабатыватьРекурсивно);
КонецПроцедуры


// Вызывается пакетным менеджером после сборки пакета.
// 
// Параметры:
//   РабочийКаталог - Строка - Текущий рабочий каталог с исходниками пакета.
//   ПутьКФайлуПакета - Строка - Полный путь к собранному файлу пакета.
// 
Процедура ПослеСборки(Знач РабочийКаталог, Знач ПутьКФайлуПакета) Экспорт
	// TODO: Реализуйте спец. логику сборки, если требуется
КонецПроцедуры



Описание.Имя("v8confbuilder")
        .Версия("1.0.0")
        .Автор("")
        .АдресАвтора("https://github.com/WonderMr/v8confbuilder")
        .Описание("Автоматическая сборка и разборка конфигурации или расширения 1С в git при помощи хуков pre_commit или post_checkout")
        .ВерсияСреды("1.0.21")
        //.ВключитьФайл("src")
        //.ВключитьФайл("doc")
        //.ВключитьФайл("tasks")
        //.ВключитьФайл("tests")
        //.ВключитьФайл("features")
			
        .ВключитьФайл("packagedef")
        //.ЗависитОт("package1", ">=2.0")
        //.ЗависитОт("package2", ">=1.1", "<2.0")
        //.ОпределяетКласс("УправлениеВселенной", "src/universe-mngr.os")
        //.ОпределяетМодуль("ПолезныеФункции", "src/tools.os")
        ;
